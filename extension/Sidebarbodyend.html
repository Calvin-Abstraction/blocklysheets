    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <!-- The CSS package above applies Google styling to buttons and other elements. -->

    <style>
    .branding-below {
      bottom: 56px;
      top: 0;
    }

    .branding-text {
      left: 7px;
      position: relative;
      top: 3px;
    }

    .col-contain {
      overflow: hidden;
    }

    .col-one {
      float: left;
      width: 50%;
    }

    .logo {
      vertical-align: middle;
    }

    .radio-spacer {
      height: 20px;
    }

    .width-100 {
      width: 100%;
    }
    </style>
  </head>

<body>
  <div class="sidebar branding-below">

<p>Build your formulas one block by block!</p>

<div id="blocklyDiv" style="height: 480px; width: 100%;"></div>

<xml id="toolbox" style="display: none">
  <category name="Logic">
	<block type="controls_if"></block>
	<block type="logic_compare"></block>
	<block type="logic_operation"></block>
	<block type="logic_negate"></block>
	<block type="logic_boolean"></block>
  </category>
  <category name="Loops">
	<block type="controls_repeat_ext">
	  <value name="TIMES">
		<block type="math_number">
		  <field name="NUM">10</field>
		</block>
	  </value>
	</block>
	<block type="controls_whileUntil"></block>
  </category>
  <category name="Math">
	<block type="math_number"></block>
	<block type="math_arithmetic"></block>
	<block type="math_single"></block>
  </category>
  <category name="Text">
	<block type="text"></block>
	<block type="text_length"></block>
	<block type="text_print"></block>
  </category>
</xml>

<xml id="startBlocks" style="display: none">
  <block type="controls_if" inline="false" x="20" y="20">
	<mutation else="1"></mutation>
	<value name="IF0">
	  <block type="logic_compare" inline="true">
		<field name="OP">EQ</field>
		<value name="A">
		  <block type="math_arithmetic" inline="true">
			<field name="OP">MULTIPLY</field>
			<value name="A">
			  <block type="math_number">
				<field name="NUM">6</field>
			  </block>
			</value>
			<value name="B">
			  <block type="math_number">
				<field name="NUM">7</field>
			  </block>
			</value>
		  </block>
		</value>
		<value name="B">
		  <block type="math_number">
			<field name="NUM">42</field>
		  </block>
		</value>
	  </block>
	</value>
	<statement name="DO0">
	  <block type="text_print" inline="false">
		<value name="TEXT">
		  <block type="text">
			<field name="TEXT">Don't panic</field>
		  </block>
		</value>
	  </block>
	</statement>
	<statement name="ELSE">
	  <block type="text_print" inline="false">
		<value name="TEXT">
		  <block type="text">
			<field name="TEXT">Panic</field>
		  </block>
		</value>
	  </block>
	</statement>
  </block>
</xml>

<script>
  var workspace = Blockly.inject('blocklyDiv',
	  {media: '../../media/',
	   toolbox: document.getElementById('toolbox')});
  Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),
							 workspace);

  function showCode() {
	// Generate JavaScript code and display it.
	Blockly.Sheets.INFINITE_LOOP_TRAP = null;
	var code = Blockly.Sheets.workspaceToCode(workspace);
	document.getElementById("generated-formulas").value = code;
  }
</script>

<p>
  <button onclick="showCode()">Show Google Sheets formulae</button>
</p>

<!-- old stuff-->  

	<form>
	  <div class="block col-contain">
	  </div>

	  <div class="block form-group">
		<label for="generated-formulas"><b>Output</b></label>
		<textarea class="width-100" id="generated-formulas" rows="4" disabled></textarea>
	  </div>

	 <div class="block" id="button-bar">
		<button class="blue" id="run-translation">Generate</button>
		<button id="insert-text">Insert</button>
	  </div>
	</form>
  </div>

  <div class="sidebar bottom">
	<img alt="Add-on logo" class="logo" src="http://clubs.calvin.edu/abstract/wp-content/uploads/2015/03/abstraction-logo.png" width="27" height="27">
	<span class="gray branding-text">Coded carefully by Abstraction</span>
  </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
  </script>
  <script>
	/**
	 * On document load, assign click handlers to each button and try to load the
	 * user's origin and destination language preferences if previously set.
	 */
	$(function() {
	  $('#run-translation').click(runTranslation);
	  $('#insert-text').click(insertText);
	  google.script.run.withSuccessHandler(loadPreferences)
		  .withFailureHandler(showError).getPreferences();
	});

	/**
	 * Callback function that populates the origin and destination selection
	 * boxes with user preferences from the server.
	 *
	 * @param {Object} languagePrefs The saved origin and destination languages.
	 */
	function loadPreferences(languagePrefs) {
	  $('input:radio[name="origin"]')
		  .filter('[value=' + languagePrefs.originLang + ']')
		  .attr('checked', true);
	  $('input:radio[name="dest"]')
		  .filter('[value=' + languagePrefs.destLang + ']')
		  .attr('checked', true);
	}

	/**
	 * Runs a server-side function to translate the user-selected text and update
	 * the sidebar UI with the resulting translation.
	 */
	function runTranslation() {
	  this.disabled = true;
	  $('#error').remove();
	  var origin = $('input[name=origin]:checked').val();
	  var dest = $('input[name=dest]:checked').val();
	  var savePrefs = $('#save-prefs').is(':checked');
	  google.script.run
		  .withSuccessHandler(
			function(textAndTranslation, element) {
			  $('#generated-formulas').val(textAndTranslation.translation);
			  element.disabled = false;
			})
		  .withFailureHandler(
			function(msg, element) {
			  showError(msg, $('#button-bar'));
			  element.disabled = false;
			})
		  .withUserObject(this)
		  .getTextAndTranslation(origin, dest, savePrefs);
	}

	/**
	 * Runs a server-side function to insert the translated text into the document
	 * at the user's cursor or selection.
	 */
	function insertText() {
	  this.disabled = true;
	  $('#error').remove();
	  google.script.run
		  .withSuccessHandler(
			function(returnSuccess, element) {
			  element.disabled = false;
			})
		  .withFailureHandler(
			function(msg, element) {
			  showError(msg, $('#button-bar'));
			  element.disabled = false;
			})
		  .withUserObject(this)
		  .insertText($('#generated-formulas').val());
	}

	/**
	 * Inserts a div that contains an error message after a given element.
	 *
	 * @param msg The error message to display.
	 * @param element The element after which to display the error.
	 */
	function showError(msg, element) {
	  var div = $('<div id="error" class="error">' + msg + '</div>');
	  $(element).after(div);
	}
  </script>
</body>
</html>